<!DOCTYPE html>
<html lang="en">
  <head>
    <% include ../partials/header.ejs %>
    <link rel="stylesheet" href="http://bootstrap-tagsinput.github.io/bootstrap-tagsinput/dist/bootstrap-tagsinput.css">
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> -->
    <script src="http://bootstrap-tagsinput.github.io/bootstrap-tagsinput/dist/bootstrap-tagsinput.min.js"></script>
  </head>
  <body>

    <% include ../partials/topnav.ejs %>
  
    <section id="project-details"  class="col-md-offset-2 col-md-10">
      <div class="col-md-10">
        <div class="details-body">

          <section>
            <form id='project-form'>
              <h1>Project details</h1>
              <p class="name input">
                <span class="label-title">Name</span>
                <input type="text"  id='name-input' value="<%= scope.project.name %>">
              </p>
              <p class="info input">
                <span class="label-title">Info</span>
                <textarea id="description-textarea"><%= scope.project.description %>
                </textarea>
              </p>
              <div class="tags select assoc">
                <p class="tags input">
                  <span class="label-title">Assoc tags</span>
                  <select multiple id='assoc-tag'>
                  </select>
                </p>
                <p >
                  <select>
                    <% scope.tags.forEach(function(tag, iter){ %>
                    <option tag-id='<%= tag.id %>'>
                      <%= tag.name %>
                    </option>
                    <% }); %>
                  </select>
                  <button class="btn btn-success add-more" select-id='assoc-tag' type="button"><i class="glyphicon glyphicon-plus"></i> Add</button>
                </p>
              </div>
              <div class="tags select stop">
                <p class="tags input">
                  <span class="label-title">Stop tags</span>
                  <select multiple id='stop-tag'>
                  </select>
                </p>
                <p >
                  <select>
                    <% scope.tags.forEach(function(tag, iter){ %>
                    <option tag-id='<%= tag.id %>'>
                      <%= tag.name %>
                    </option>
                    <% }); %>
                  </select>
                  <button class="btn btn-success add-more"  select-id='stop-tag' type="button"><i class="glyphicon glyphicon-plus"></i> Add</button>
                </p>
              </div>
              <div class="main-butt-forth">
                <input class="btn btn-danger" value="DELETE">
                <input class="btn btn-success" type="submit" value="SAVE">
              </div>
            </form>
          </section>
          <hr>
          <section>
            <h1>Project info </h1>
            <p class="size input">
              <span class="label-title">Size</span>
              <input type="text"  id='size-input' value="<%= scope.size %> objects" readonly>
            </p>
          </section>
          <hr>
          <section>
            <form>
              <h1>Data Base</h1>
              <p class="size input">
                <span class="label-title">host</span>
                <input type="text"  id='host-input' value="" >
              </p>
              <p class="size input">
                <span class="label-title">user</span>
                <input type="text"  id='user-input' value="" >
              </p>
              <p class="size input">
                <span class="label-title">password</span>
                <input type="text"  id='pass-input' value="" >
              </p>
              <p class="size input">
                <span class="label-title">Name</span>
                <input type="text"  id='name-input' value="" >
              </p>
            </form>
          </section>

        </div>
      </div>
    </section>
    <script type="text/javascript">
    $(function(){
      $('#stop-tag').tagsinput({
        allowDuplicates: false,
        itemValue: 'id',
        itemText: 'label'
      });

      $('#assoc-tag').tagsinput({
        allowDuplicates: false,
        itemValue: 'id',
        itemText: 'label'
      });

      $(".bootstrap-tagsinput input").attr("readonly", true);

      <% scope.relation.forEach(function(tag, iter){ %>
        <% if (tag.positive == 0) { %>
          $('#stop-tag').tagsinput('add', {"id":<%= tag.tagID %>, "label": "<%= tag.name %>"} );
        <% }else{ %>
          $('#assoc-tag').tagsinput('add', {"id":<%= tag.tagID %>, "label": "<%= tag.name %>"} );
        <% } %>
      <% }); %>
      
      $('div.tags button.add-more').on('click', (e)=>{
        console.log('click');
        var btn = e.target;
        var neighbour = btn.previousElementSibling;
        var tag_name = neighbour.options[neighbour.selectedIndex].value;
        var tag_id = neighbour.options[neighbour.selectedIndex].getAttribute('tag-id');
        var select_id = btn.getAttribute('select-id');
        var select = document.getElementById(select_id);
        var select_name = '#'+select_id;
        // console.log( {"id":tag_id, "label":tag_name} );
        $(select_name).tagsinput('add', {"id":tag_id, "label":tag_name} );
      });
    });
    </script>
  </body>
</html>