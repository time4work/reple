<!DOCTYPE html>
<html class="ng-scope" np-app="Reple">
<head>
  <% include ../partials/header.ejs %>
</head>
<body class='side-pad'>
  <% include ../partials/topnav.ejs %>
  <% include ../partials/leftnav.ejs %>
  
  <div class="container">
  	<h1>Object List Page</h1>
    <h3>Data length: <%=scope.size%></h3>
    <h3>Ready Objects: <%=scope.size2%></h3>
  	<hr>
    <ul class='object-menu'>
      <li>
          <i class="fa fa-camera-retro" aria-hidden="true"></i>
          <span>Make Thumbs</span>
          <button onclick='makeThumbs(event)'>start</button>
          <button onclick='stopMakeThumbs(event)'>stop</button>
      </li>
      <li>
          <i class="fa fa-eye" aria-hidden="true"></i>
        <a href="#">
          <span>check links</span>
        </a>
      </li>
    </ul>
    <hr>
	<!-- <div class="psearch">
		<input type="text" id="search" placeholder="SEARCH BY NAME" >
		<img class="find noselect" src="/img/s-icon.svg">
	</div> -->
  	<table class="table table-bordered">
        <thead>
          <tr>
            <th>Id</th>
            <th>Thumbs</th>
            <th>Title</th>
            <th>Description</th>
            <th>link</th>
          </tr>
        </thead>

        <tbody id='search-tbody'>
        </tbody>

        <tbody id='list-tbody'>
          <% scope.objects.forEach(function(obj, iter) { %>
          <tr>
            <td class="number"> <%= obj.id %> </td>
            <td>
              <%if ( obj.DataLink2 ){ %>
                <i class='fa fa-check' aria-hidden='true' style='color:green;'></i>
              <% } %> 
            </td>
            <td><%= obj.DataTitle1 %></td>
            <td><%= obj.DataText1 %></td>
            <td><a href="<%= obj.DataLink1 %>">link</a></td>
          </tr>
          <% }); %>
        </tbody>
    </table>
  </div>
</body>
<script>
  const projectID = <%=scope.project.id%>;
  function stopMakeThumbs(event){
    if (event.preventDefault) event.preventDefault();
    console.log('click');
    data = {};
    data.type = 'process.thumbs.make.terminate';
    if( confirm("are you sure?") ){
      // blockTheKraken();
      ajax('/project/'+projectID+'/objects/', data, (result)=>{
        console.log(result);
        // releaseTheKraken();
        // alert('finish');
      });
    }
  }
  function makeThumbs(event){
    if (event.preventDefault) event.preventDefault();
    console.log('click');
    data = {};
    data.type = 'objects.thumbs.make';

    if( confirm("are you sure?") ){
      // blockTheKraken();
      ajax('/project/'+projectID+'/objects/', data, (result)=>{
        console.log(result);
        // releaseTheKraken();
        alert('finish');
      });
    }
  }

  $(function(){
    console.log('start');
    // var eventSource = new EventSource("/project/1/objects/");

    // eventSource.onmessage = function(e) {
    //   console.log("Пришло сообщение: " + e.data);
    //   console.log(e);
    // };
  });
</script>
</html>
